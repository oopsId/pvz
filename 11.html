<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Яндекс.PVZ - Проверка заказов</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Yandex Sans Text', Arial, sans-serif;
        }

        body {
            background-color: #1A1A1A;
            color: #fff;
            overflow: hidden;
        }

        #scene-container {
            position: absolute;
            top: 0;
            width: 100%;
            height: 55%; /* Уменьшено для поднятия нижней части */
        }

        #game-ui {
            display: flex;
            flex-direction: row;
            gap: 20px;
            padding: 20px;
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 45%; /* Увеличено для поднятия */
            background: rgba(26, 26, 26, 0.85);
            border-top: 4px solid #FF9A00;
        }

        #document-panel {
            flex: 1;
            background: rgba(40, 40, 40, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        #doc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #FF9A00;
        }

        #doc-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #FF9A00;
        }

        #doc-number {
            font-size: 0.9rem;
            color: #aaa;
        }

        .doc-section {
            margin-bottom: 15px;
        }

        .doc-label {
            font-size: 0.9rem;
            color: #888;
        }

        .doc-value {
            font-size: 1.1rem;
            margin-bottom: 10px;
            background: rgba(60, 60, 60, 0.5);
            padding: 5px 8px;
            border-radius: 4px;
        }

        #right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #dialog-log {
            flex: 2;
            background: rgba(26, 26, 26, 0.7);
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #FF9A00;
            overflow-y: auto;
        }

        #control-panel {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .control-btn {
            background: linear-gradient(to bottom, #404040, #2a2a2a);
            color: white;
            border: none;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            border-left: 4px solid #FF9A00;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-btn:hover {
            background: linear-gradient(to bottom, #505050, #3a3a3a);
            transform: translateY(-2px);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .dialog-line {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .dialog-line.system { color: #FF9A00; }
        .dialog-line.success { color: #2ecc71; }
        .dialog-line.alert { color: #e74c3c; }

        #stats-panel {
            display: none;
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(26, 26, 26, 0.7);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #FF9A00;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #aaa;
            margin-right: 15px;
        }

        .stat-value {
            font-weight: bold;
        }

        #timer-panel {
            display: none;
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(26, 26, 26, 0.7);
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid #FF9A00;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        #customer-panel {
            display: none;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 26, 0.7);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #FF9A00;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 200px;
        }

        #customer-image {
            width: 120px;
            height: 120px;
            margin-bottom: 10px;
            border-radius: 50%;
        }

        #customer-name {
            font-size: 1.2rem;
        }

        #customer-mood {
            margin-top: 5px;
            color: #aaa;
            font-size: 1rem;
        }

        #loading-screen {
            width: 100%;
            height: 100%;
            background: #1A1A1A;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: absolute;
            z-index: 100;
        }

        #loading-text {
            font-size: 1.2rem;
            color: #aaa;
            margin-bottom: 20px;
        }

        #loading-bar {
            width: 300px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
        }

        #loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(to right, #FF9A00, #FFC107);
            transition: width 0.3s;
        }

        #title-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1A1A1A, #000);
            position: absolute;
            z-index: 99;
        }

        #title-logo {
            width: 300px;
            margin-bottom: 50px;
        }

        #title-text {
            font-size: 2.5rem;
            margin-bottom: 30px;
            background: linear-gradient(to right, #FF9A00, #FFC107);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        #start-button {
            background: linear-gradient(to right, #FF9A00, #FFC107);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(255, 154, 0, 0.3);
        }

        #start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 154, 0, 0.4);
        }

        #rules {
            max-width: 600px;
            margin-top: 30px;
            text-align: center;
            line-height: 1.6;
            color: #aaa;
        }

        #prompt-overlay {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        #prompt-box {
            background: #222;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #FF9A00;
        }

        #prompt-message {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        #prompt-continue {
            background: linear-gradient(to right, #FF9A00, #FFC107);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        #stamp-approved, #stamp-rejected {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        #stamp-approved {
            left: 30%;
            color: #2ecc71;
        }

        #stamp-rejected {
            left: 70%;
            color: #e74c3c;
        }

        .show-stamp {
            opacity: 1;
            animation: stampIn 0.5s forwards;
        }

        @keyframes stampIn {
            0% { transform: scale(5); opacity: 0; }
            80% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        .highlight {
            background-color: rgba(255, 154, 0, 0.3);
            transition: background-color 0.3s;
        }

        .error-highlight {
            background-color: rgba(231, 76, 60, 0.5);
            animation: errorShake 0.3s;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        #volume-control {
            position: absolute;
            top: 20px;
            right: 60px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
        }

        #volume-slider {
            width: 100px;
        }

        @media (max-width: 768px) {
            #game-ui {
                flex-direction: column;
                padding: 10px;
            }
            
            #right-panel {
                flex-direction: column;
            }
            
            #dialog-log {
                height: 100px;
            }
            
            #control-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Yandex+Sans+Text:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.18.0/js/md5.min.js"></script>
</head>
<body>
    <div id="scene-container"></div>

    <div id="loading-screen">
        <div id="loading-text">Загрузка пункта выдачи заказов...</div>
        <div id="loading-bar">
            <div id="loading-progress"></div>
        </div>
    </div>

    <div id="title-screen">
        <img id="title-logo" src="https://yastatic.net/s3/eda-front/www/3.7.0/assets/yandex-market-logo.f066e2e.png" alt="Яндекс Маркет">
        <h1 id="title-text">PVZ: Стажёр Юля Градволь</h1>
        <div id="rules">
            Вы — Юлия Градволь, новый стажёр в пункте выдачи заказов Яндекс Маркета.<br>
            Ваша задача — проверять документы клиентов, коды получения и соответствие товаров заказу.<br>
            Работайте быстро, но внимательно — от вашего рейтинга зависит зарплата и карьера!<br>
            <br>
            Стажировка длится 90 дней. Докажите, что достойны постоянной должности!
        </div>
        <button id="start-button">Начать стажировку</button>
    </div>

    <div id="game-ui">
        <div id="document-panel">
            <div id="doc-header">
                <div id="doc-title">Яндекс Маркет - Накладная</div>
                <div id="doc-number">№ YM-00000000</div>
            </div>
            <div class="doc-section">
                <div class="doc-label">Получатель</div>
                <div class="doc-value" id="customer-field">---</div>
            </div>
            <div class="doc-section">
                <div class="doc-label">Номер заказа</div>
                <div class="doc-value" id="order-field">---</div>
            </div>
            <div class="doc-section">
                <div class="doc-label">Дата доставки</div>
                <div class="doc-value" id="date-field">---</div>
            </div>
            <div class="doc-section">
                <div class="doc-label">Товары</div>
                <div class="doc-value" id="items-field">---</div>
            </div>
            <div class="doc-section">
                <div class="doc-label">Стоимость</div>
                <div class="doc-value" id="price-field">---</div>
            </div>
            <div class="doc-section">
                <div class="doc-label">Код получения</div>
                <div class="doc-value" id="code-field">---</div>
            </div>
            <div class="doc-section">
                <div class="doc-label">Документ</div>
                <div class="doc-value" id="document-field">---</div>
            </div>
            <div id="stamp-approved" class="stamp">
                <i class="fas fa-check-circle fa-4x"></i>
                <div>ОДОБРЕНО</div>
            </div>
            <div id="stamp-rejected" class="stamp">
                <i class="fas fa-times-circle fa-4x"></i>
                <div>ОТКАЗАНО</div>
            </div>
        </div>

        <div id="right-panel">
            <div id="dialog-log"></div>
            <div id="control-panel">
                <button id="approve-btn" class="control-btn">
                    <i class="fas fa-check-circle"></i> Выдать заказ
                </button>
                <button id="reject-btn" class="control-btn">
                    <i class="fas fa-times-circle"></i> Отказать
                </button>
                <button id="check-doc-btn" class="control-btn">
                    <i class="fas fa-id-card"></i> Проверить документ
                </button>
                <button id="check-code-btn" class="control-btn">
                    <i class="fas fa-barcode"></i> Проверить код
                </button>
                <button id="check-items-btn" class="control-btn">
                    <i class="fas fa-box-open"></i> Проверить товары
                </button>
                <button id="next-btn" class="control-btn">
                    <i class="fas fa-forward"></i> Следующий клиент
                </button>
            </div>
        </div>
    </div>

    <div id="stats-panel">
        <div class="stat-row">
            <span class="stat-label">День:</span>
            <span class="stat-value" id="day-value">1/90</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Время:</span>
            <span class="stat-value" id="time-value">08:00</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Клиенты:</span>
            <span class="stat-value" id="customers-value">0/30</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Рейтинг:</span>
            <span class="stat-value" id="rating-value">50%</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Зарплата:</span>
            <span class="stat-value" id="money-value">0 ₽</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Осталось:</span>
            <span class="stat-value" id="days-left-value">89 дней</span>
        </div>
    </div>

    <div id="timer-panel">
        <i class="fas fa-clock"></i>
        <span id="timer-value">08:00</span>
    </div>

    <div id="customer-panel">
        <img id="customer-image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzMzIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iNDgiIGZvbnQtZmFtaWx5PSJBcmlhbCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGZpbGw9IiNmZmYiPkM8L3RleHQ+PC9zdmc+" width="120" height="120">
        <div id="customer-name">---</div>
        <div id="customer-mood">---</div>
    </div>

    <div id="prompt-overlay">
        <div id="prompt-box">
            <div id="prompt-message"></div>
            <button id="prompt-continue">Продолжить</button>
        </div>
    </div>

    <div id="volume-control">
        <i class="fas fa-volume-up"></i>
        <input type="range" id="volume-slider" min="0" max="100" value="20">
    </div>

    <!-- Audio elements -->
    <audio id="bgm" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="approve-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">
    </audio>
    <audio id="reject-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-10.mp3" type="audio/mpeg">
    </audio>
    <audio id="error-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-21.mp3" type="audio/mpeg">
    </audio>
    <audio id="check-sound">
        <source src="https://www.soundjay.com/buttons/sounds/button-04.mp3" type="audio/mpeg">
    </audio>

    <!-- Three.js and other libraries -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>

    <!-- Здесь начинается первый скрипт -->
    <script>
        // Game state
        const gameState = {
            day: 1,
            maxDays: 90,
            time: 480, // 8:00 in minutes
            score: 50,
            money: 0,
            customers: 0,
            totalCustomers: 30,
            currentCustomer: null,
            isChecking: false,
            gameStarted: false,
            mistakes: 0,
            musicVolume: 0.2,
            customerQueue: [],
            lastDialog: ''
        };

        // Audio elements
        const bgm = document.getElementById('bgm');
        bgm.volume = gameState.musicVolume;
        const approveSound = document.getElementById('approve-sound');
        const rejectSound = document.getElementById('reject-sound');
        const errorSound = document.getElementById('error-sound');
        const checkSound = document.getElementById('check-sound');

        // Volume control
        const volumeSlider = document.getElementById('volume-slider');
        volumeSlider.addEventListener('input', () => {
            const volume = volumeSlider.value / 100;
            bgm.volume = volume;
            gameState.musicVolume = volume;
        });

        // 3D Scene Setup
        let scene, camera, renderer, controls, sky;
        function init3DScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xE6ECEF); // Менее яркий серый для гармонии с UI

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 3);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight / 2);
            renderer.shadowMap.enabled = true;
            document.getElementById('scene-container').appendChild(renderer.domElement);

            // Освещение
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 1, 100);
            pointLight.position.set(0, 5, 0);
            pointLight.castShadow = true;
            scene.add(pointLight);

            // Пол
            const floorGeometry = new THREE.PlaneGeometry(10, 10);
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0xD3D8DB, roughness: 0.8 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Стены с орнаментом
            const wallMaterial = new THREE.MeshStandardMaterial({ color: 0xF5F5F5, roughness: 0.4 });
            const backWall = new THREE.Mesh(new THREE.BoxGeometry(10, 4, 0.2), wallMaterial);
            backWall.position.set(0, 2, -5);
            scene.add(backWall);

            // Орнамент на стене (желтые линии)
            const ornamentGeometry = new THREE.PlaneGeometry(8, 0.1);
            const ornamentMaterial = new THREE.MeshBasicMaterial({ color: 0xFF9A00 });
            for (let i = 0; i < 3; i++) {
                const ornament = new THREE.Mesh(ornamentGeometry, ornamentMaterial);
                ornament.position.set(0, 1 + i * 1.2, -4.95);
                scene.add(ornament);
            }

            // Стеклянные двери
            const doorGeometry = new THREE.PlaneGeometry(1, 3);
            const doorMaterial = new THREE.MeshPhysicalMaterial({
                color: 0xFFFFFF,
                transparent: true,
                opacity: 0.5,
                roughness: 0.1,
                metalness: 0.8,
                transmission: 0.9 // Эффект стекла
            });
            const leftDoor = new THREE.Mesh(doorGeometry, doorMaterial);
            leftDoor.position.set(-0.5, 1.5, -5.01);
            scene.add(leftDoor);
            const rightDoor = new THREE.Mesh(doorGeometry, doorMaterial);
            rightDoor.position.set(0.5, 1.5, -5.01);
            scene.add(rightDoor);

            // Динамическое фоновое небо
            const skyGeometry = new THREE.PlaneGeometry(10, 4);
            const skyMaterial = new THREE.MeshBasicMaterial({ color: 0x87CEEB });
            sky = new THREE.Mesh(skyGeometry, skyMaterial);
            sky.position.set(0, 2, -5.1);
            scene.add(sky);

            // Стойка с глянцевой крышкой
            const counterGeometry = new THREE.BoxGeometry(3, 1.2, 1.5);
            const counterMaterial = new THREE.MeshStandardMaterial({ color: 0xFF9A00, roughness: 0.6 });
            const counter = new THREE.Mesh(counterGeometry, counterMaterial);
            counter.position.set(0, 0.6, -2);
            counter.castShadow = true;
            scene.add(counter);

            const counterTopGeometry = new THREE.BoxGeometry(3.2, 0.05, 1.7);
            const counterTopMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x333333,
                roughness: 0.2,
                metalness: 0.9
            });
            const counterTop = new THREE.Mesh(counterTopGeometry, counterTopMaterial);
            counterTop.position.set(0, 1.25, -2);
            scene.add(counterTop);

            // Этажерка с товарами
            const shelfGeometry = new THREE.BoxGeometry(6, 0.05, 1.5);
            const shelfMaterial = new THREE.MeshStandardMaterial({ color: 0x666666, roughness: 0.7 });
            for (let i = 0; i < 3; i++) {
                const shelf = new THREE.Mesh(shelfGeometry, shelfMaterial);
                shelf.position.set(0, 1.5 + i * 1.2, -4.5);
                shelf.castShadow = true;
                scene.add(shelf);

                for (let j = 0; j < 3; j++) {
                    const boxSize = 0.4 + Math.random() * 0.4;
                    const boxGeometry = new THREE.BoxGeometry(boxSize, boxSize, boxSize);
                    const boxMaterial = new THREE.MeshStandardMaterial({ color: Math.random() * 0xffffff });
                    const box = new THREE.Mesh(boxGeometry, boxMaterial);
                    box.position.set(-2 + j * 2, 1.7 + i * 1.2, -4.5);
                    box.castShadow = true;
                    scene.add(box);
                }
            }

            // Логотип Яндекс
            const logoGeometry = new THREE.PlaneGeometry(1.5, 0.5);
            const logoTexture = new THREE.TextureLoader().load('https://yastatic.net/s3/eda-front/www/3.7.0/assets/yandex-market-logo.f066e2e.png', texture => {
                const logoMaterial = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
                const logo = new THREE.Mesh(logoGeometry, logoMaterial);
                logo.position.set(0, 3.5, -4.99);
                scene.add(logo);
            });

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableZoom = false;
            controls.enablePan = false;
            controls.maxPolarAngle = Math.PI * 0.4;
            controls.minPolarAngle = Math.PI * 0.2;
            controls.enableDamping = true;

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / (window.innerHeight / 2);
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight / 2);
            });

            let skyHue = 0;
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                
                // Динамическое небо
                skyHue += 0.001;
                sky.material.color.setHSL(skyHue % 1, 0.5, 0.7);
                
                renderer.render(scene, camera);
            }
            animate();
        }

        // Utility functions
        function formatTime(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
        }

        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function weightedRandom(items, weights) {
            const cumulativeWeights = [];
            for (let i = 0; i < weights.length; i++) {
                cumulativeWeights[i] = weights[i] + (cumulativeWeights[i - 1] || 0);
            }
            const max = cumulativeWeights[cumulativeWeights.length - 1];
            const randomNumber = max * Math.random();
            for (let i = 0; i < cumulativeWeights.length; i++) {
                if (cumulativeWeights[i] >= randomNumber) {
                    return items[i];
                }
            }
        }

        // Customer generator
        function generateCustomer(isCorrect) {
            const firstNamesMale = ['Александр', 'Дмитрий', 'Максим', 'Сергей', 'Андрей'];
            const firstNamesFemale = ['Анна', 'Мария', 'Елена', 'Дарья', 'Алина'];
            const lastNamesMale = ['Иванов', 'Петров', 'Смирнов', 'Сидоров', 'Кузнецов'];
            const lastNamesFemale = ['Иванова', 'Петрова', 'Смирнова', 'Сидорова', 'Кузнецова'];
            const maleMiddleNames = ['Иванович', 'Петрович', 'Александрович', 'Сергеевич'];
            const femaleMiddleNames = ['Ивановна', 'Петровна', 'Александровна', 'Сергеевна'];

            const isMale = Math.random() > 0.5;
            const firstName = isMale ? firstNamesMale[randomInt(0, firstNamesMale.length - 1)] : firstNamesFemale[randomInt(0, firstNamesFemale.length - 1)];
            const lastName = isMale ? lastNamesMale[randomInt(0, lastNamesMale.length - 1)] : lastNamesFemale[randomInt(0, lastNamesFemale.length - 1)];
            const middleName = isMale ? maleMiddleNames[randomInt(0, maleMiddleNames.length - 1)] : femaleMiddleNames[randomInt(0, femaleMiddleNames.length - 1)];

            const orderNumber = `YM-${new Date().getFullYear()}${randomInt(100000, 999999)}`;
            const orderDate = new Date();
            orderDate.setDate(orderDate.getDate() - randomInt(0, 7));
            const formattedDate = orderDate.toLocaleDateString('ru-RU');

            const products = [
                { name: 'Смартфон Xiaomi', brand: 'Xiaomi' },
                { name: 'Наушники Sony', brand: 'Sony' },
                { name: 'Ноутбук ASUS', brand: 'ASUS' },
                { name: 'Кофемашина Philips', brand: 'Philips' },
                { name: 'Планшет Samsung', brand: 'Samsung' }
            ];
            const items = [];
            for (let i = 0; i < randomInt(1, 3); i++) {
                const product = products[randomInt(0, products.length - 1)];
                const quantity = randomInt(1, 3);
                items.push(`${product.name}, ${quantity} шт.`);
            }

            const totalPrice = randomInt(1000, 10000);
            const formattedPrice = new Intl.NumberFormat('ru-RU').format(totalPrice) + ' ₽';
            const code = `${randomInt(1000, 9999)} ${randomInt(1000, 9999)}`;
            const document = `Паспорт РФ: 45${randomInt(10, 49)} ${randomInt(100000, 999999)}`;

            let issue = '';
            let errorText = '';
            if (!isCorrect) {
                const issueTypes = ['wrongDocument', 'wrongCode', 'wrongItems', 'expiredDate', 'fakedDocument'];
                const weights = [0.2, 0.2, 0.2, 0.2, 0.2];
                issue = weightedRandom(issueTypes, weights);
                switch (issue) {
                    case 'wrongDocument':
                        errorText = 'Неверный документ';
                        return { ...baseCustomer(), document: 'Водительское удостоверение' };
                    case 'wrongCode':
                        errorText = 'Неверный код';
                        return { ...baseCustomer(), code: `${randomInt(1000, 9999)} ${randomInt(1000, 9999)}` };
                    case 'wrongItems':
                        errorText = 'Неверные товары';
                        items.pop();
                        break;
                    case 'expiredDate':
                        errorText = 'Заказ просрочен';
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        return { ...baseCustomer(), date: yesterday.toLocaleDateString('ru-RU') };
                    case 'fakedDocument':
                        errorText = 'Поддельный документ';
                        return { ...baseCustomer(), document: `Паспорт РФ: 99${randomInt(10, 99)} ${randomInt(100000, 999999)}` };
                }
            }

            function baseCustomer() {
                return {
                    name: `${lastName} ${firstName} ${middleName}`,
                    order: orderNumber,
                    date: formattedDate,
                    items: items,
                    price: formattedPrice,
                    code: code,
                    document: document,
                    correct: isCorrect,
                    issue: issue,
                    errorText: errorText
                };
            }

            return baseCustomer();
        }

        // UI functions
        function updateUI() {
            document.getElementById('day-value').textContent = `${gameState.day}/${gameState.maxDays}`;
            document.getElementById('time-value').textContent = formatTime(gameState.time);
            document.getElementById('customers-value').textContent = `${gameState.customers}/${gameState.totalCustomers}`;
            document.getElementById('rating-value').textContent = `${gameState.score}%`;
            document.getElementById('money-value').textContent = `${gameState.money} ₽`;
            document.getElementById('days-left-value').textContent = `${gameState.maxDays - gameState.day} дней`;
            document.getElementById('timer-value').textContent = formatTime(gameState.time);
        }

        function addDialogLine(text, type = 'neutral') {
            if (text === gameState.lastDialog) return;
            gameState.lastDialog = text;
            const dialogLog = document.getElementById('dialog-log');
            const line = document.createElement('div');
            line.className = `dialog-line ${type}`;
            line.textContent = text;
            dialogLog.appendChild(line);
            dialogLog.scrollTop = dialogLog.scrollHeight;
        }

        function highlightElement(elementId, isError = false) {
            const element = document.getElementById(elementId);
            element.classList.remove('highlight', 'error-highlight');
            setTimeout(() => {
                element.classList.add(isError ? 'error-highlight' : 'highlight');
                playSound(isError ? errorSound : checkSound);
            }, 50);
        }

        function showStamp(approved = true) {
            const stamp = approved ? document.getElementById('stamp-approved') : document.getElementById('stamp-rejected');
            stamp.classList.add('show-stamp');
            playSound(approved ? approveSound : rejectSound);
            setTimeout(() => stamp.classList.remove('show-stamp'), 1500);
        }

        function updateCustomerMood(mood) {
            const moodElement = document.getElementById('customer-mood');
            moodElement.textContent = mood;
            moodElement.style.color = mood === 'Доволен' ? '#2ecc71' : mood === 'Рассержен' ? '#e74c3c' : '#aaa';
        }

        function playSound(soundElement) {
            soundElement.volume = gameState.musicVolume;
            soundElement.currentTime = 0;
            soundElement.play().catch(e => console.log("Audio playback prevented:", e));
        }

        // Game loop for time
        function gameLoop() {
            if (!gameState.gameStarted) return;
            gameState.time++;
            updateUI();

            if (gameState.time >= 1080) {
                endDay();
                gameState.gameStarted = false;
            }
        }

        // Game functions
        function startNewDay() {
            gameState.customers = 0;
            gameState.time = 480;
            gameState.totalCustomers = 30;
            gameState.customerQueue = [];
            const correctRatio = 0.7;
            for (let i = 0; i < gameState.totalCustomers; i++) {
                gameState.customerQueue.push(generateCustomer(Math.random() < correctRatio));
            }
            updateUI();
            addDialogLine(`День ${gameState.day} стажировки начался!`, 'system');
            startNextCustomer();
            gameState.gameStarted = true;
        }

        function getUserAvatar(name) {
            const email = `${name.split(' ')[1].toLowerCase()}@example.com`;
            const hash = md5(email);
            return `https://www.gravatar.com/avatar/${hash}?s=120&d=identicon`;
        }

        function startNextCustomer() {
            if (gameState.customers >= gameState.totalCustomers) {
                endDay();
                return;
            }
            gameState.isChecking = true;
            gameState.currentCustomer = gameState.customerQueue[gameState.customers];

            document.getElementById('customer-field').textContent = gameState.currentCustomer.name;
            document.getElementById('order-field').textContent = gameState.currentCustomer.order;
            document.getElementById('date-field').textContent = gameState.currentCustomer.date;
            document.getElementById('items-field').textContent = gameState.currentCustomer.items.join('\n');
            document.getElementById('price-field').textContent = gameState.currentCustomer.price;
            document.getElementById('code-field').textContent = gameState.currentCustomer.code;
            document.getElementById('document-field').textContent = gameState.currentCustomer.document;

            document.getElementById('customer-name').textContent = gameState.currentCustomer.name;
            document.getElementById('customer-image').src = getUserAvatar(gameState.currentCustomer.name);
            updateCustomerMood('Ожидает выдачи заказа');
            document.getElementById('customer-panel').style.display = 'flex';

            addDialogLine(`${gameState.currentCustomer.name}: "Здравствуйте, я за заказом."`);
        }

        function checkDocument() {
            if (!gameState.isChecking || !gameState.currentCustomer) return;
            highlightElement('document-field', gameState.currentCustomer.issue === 'wrongDocument' || gameState.currentCustomer.issue === 'fakedDocument');
            if (gameState.currentCustomer.correct || (gameState.currentCustomer.issue !== 'wrongDocument' && gameState.currentCustomer.issue !== 'fakedDocument')) {
                addDialogLine("✔ Документ проверен.", 'success');
                updateCustomerMood('Показывает документ');
            } else {
                addDialogLine(`✖ ${gameState.currentCustomer.errorText}`, 'alert');
                updateCustomerMood('Раздражён');
            }
        }

        function checkCode() {
            if (!gameState.isChecking || !gameState.currentCustomer) return;
            highlightElement('code-field', gameState.currentCustomer.issue === 'wrongCode');
            if (gameState.currentCustomer.correct || gameState.currentCustomer.issue !== 'wrongCode') {
                addDialogLine("✔ Код подтверждён.", 'success');
                updateCustomerMood('Предоставляет код');
            } else {
                addDialogLine(`✖ ${gameState.currentCustomer.errorText}`, 'alert');
                updateCustomerMood('Раздражён');
            }
        }

        function checkItems() {
            if (!gameState.isChecking || !gameState.currentCustomer) return;
            highlightElement('items-field', gameState.currentCustomer.issue === 'wrongItems');
            if (gameState.currentCustomer.correct || gameState.currentCustomer.issue !== 'wrongItems') {
                addDialogLine("✔ Товары проверены.", 'success');
                updateCustomerMood('Ждёт проверку');
            } else {
                addDialogLine(`✖ ${gameState.currentCustomer.errorText}`, 'alert');
                updateCustomerMood('Нервничает');
            }
        }

        function approveCustomer() {
            if (!gameState.isChecking) return;
            showStamp(true);
            if (gameState.currentCustomer.correct) {
                gameState.score = Math.min(100, gameState.score + 5);
                gameState.money += 100;
                addDialogLine("✔ Клиент обслужен. Рейтинг +5%", 'success');
                updateCustomerMood('Доволен');
            } else {
                gameState.score = Math.max(0, gameState.score - 10);
                gameState.mistakes++;
                addDialogLine(`✖ Ошибка: ${gameState.currentCustomer.errorText}. Рейтинг -10%`, 'alert');
                updateCustomerMood('Рассержен');
            }
            endCustomer();
        }

        function rejectCustomer() {
            if (!gameState.isChecking) return;
            showStamp(false);
            if (!gameState.currentCustomer.correct) {
                gameState.score = Math.min(100, gameState.score + 5);
                gameState.money += 50;
                addDialogLine(`✔ Отказано верно: ${gameState.currentCustomer.errorText}. Рейтинг +5%`, 'success');
                updateCustomerMood('Уходит разочарованный');
            } else {
                gameState.score = Math.max(0, gameState.score - 15);
                gameState.mistakes++;
                addDialogLine("✖ Ошибка: клиент был прав. Рейтинг -15%", 'alert');
                updateCustomerMood('Рассержен');
            }
            endCustomer();
        }

        function endCustomer() {
            gameState.customers++;
            gameState.isChecking = false;
            updateUI();
            setTimeout(startNextCustomer, 1000);
        }

        function addFireworks() {
            const fireworksStyle = document.createElement('style');
            fireworksStyle.innerHTML = `
                .firework {
                    position: absolute;
                    width: 5px;
                    height: 5px;
                    background: radial-gradient(circle, #FF9A00, #FFC107, transparent);
                    border-radius: 50%;
                    animation: explode 1s ease-out forwards;
                }
                @keyframes explode {
                    0% { transform: scale(0); opacity: 1; }
                    100% { transform: scale(20); opacity: 0; }
                }
            `;
            document.head.appendChild(fireworksStyle);

            for (let i = 0; i < 20; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = `${Math.random() * 100}%`;
                firework.style.top = `${Math.random() * 100}%`;
                firework.style.animationDelay = `${Math.random() * 0.5}s`;
                document.body.appendChild(firework);
                setTimeout(() => firework.remove(), 1500);
            }
        }

        function endDay() {
            document.getElementById('prompt-overlay').style.display = 'flex';
            document.getElementById('prompt-message').innerHTML = 
                `Вы обслужили ${gameState.customers} клиентов с рейтингом ${gameState.score}%.` +
                `<br>Ваша зарплата за сегодня: ${gameState.money} ₽.` +
                `<br>Осталось ${gameState.maxDays - gameState.day} дней стажировки.`;

            if (gameState.score === 100 && gameState.customers === gameState.totalCustomers) {
                addFireworks();
            }
            gameState.day++;
        }

        function initLoadingScreen() {
            const loadingProgress = document.getElementById('loading-progress');
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += 20;
                loadingProgress.style.width = `${progress}%`;
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.display = 'none';
                        document.getElementById('title-screen').style.display = 'flex';
                    }, 500);
                }
            }, 300);
        }

        function initGame() {
            gameState.gameStarted = true;
            document.getElementById('title-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            document.getElementById('timer-panel').style.display = 'flex';
            document.getElementById('stats-panel').style.display = 'block';
            document.getElementById('dialog-log').style.display = 'block';
            startNewDay();
            if (gameState.musicVolume > 0) bgm.play();
            init3DScene();
            setInterval(gameLoop, 1000);
        }

        // Event listeners
        document.getElementById('start-button').addEventListener('click', initGame);
        document.getElementById('approve-btn').addEventListener('click', approveCustomer);
        document.getElementById('reject-btn').addEventListener('click', rejectCustomer);
        document.getElementById('check-doc-btn').addEventListener('click', checkDocument);
        document.getElementById('check-code-btn').addEventListener('click', checkCode);
        document.getElementById('check-items-btn').addEventListener('click', checkItems);
        document.getElementById('next-btn').addEventListener('click', startNextCustomer);
        document.getElementById('prompt-continue').addEventListener('click', () => {
            document.getElementById('prompt-overlay').style.display = 'none';
            startNewDay();
        });

        window.onload = initLoadingScreen;
    </script>
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'927f92016f836788',t:'MTc0MzI1MzQzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>